# TXSQL 数据库简介

## 一、TXQSQL简介
txsql提供了类似于MySQL企业版的诸多功能,如企业级透明数据加密、审计、线程池、加密函数、备份恢复等功能。  
txsql不仅对InnoDB存储引擎、查询优化、复制性能等方面进行了大量优化，同时提升了云数据库MySQL的引用行和可维护性，为用户提供MySQL全部功能的同时，还提供了企业级的容灭、恢复、监控、性能优化、读写分离、透明数据加密、审计等高级特性。

## 二、TXSQL改进
txsql对于MySQL的改进分为：功能性改进、性能类改进、安全类改进、稳定性改进  
* 功能性改进：自动kill空闲事务、并行复制、动态线程池、支持returning、列压缩（大字段压缩）
* 功能性改进：大事务复制、计划缓存点查优化、支持使用fdatasync、支持自增列持久化、bufferpool初始化、FAST DDL、CATS事务调度、计算下推
* 安全类改进：透明数据加密、审计
* 稳定类改进：秒级加列、异步删除大表、热点更新、SQL限流、statement outline

## 三、功能类改进
* 自动kill空闲事务：KILL超过一定时常的空闲事务，及时释放资源。
* 并行复制：针对并行复制功能进行了优化，支持按table并行，相当于将其粒度拆分至表，提升了并行度，从而减少了主从延迟。
* 动态线程池：再不重启数据库的情况下，动态开启或关闭线程池。
* 支持returning：在DML操作后返回刚操作的数据行。
* 列压缩：列压缩功能可以压缩那些访问不频繁的大字段而不压缩那些访问频繁的小字段，此时不仅能够减少整行字段的存储空间，而且可以提高读写访问的效率。
  
## 四、性能类改进
* 大事务复制：自动识别大事务，并将row模式的binlog转化为statement格式的binlog，从而减少binlog并提升复制效率。
* 计划缓存点查优化：执行计划缓存能力在preparestatement模式起作用，preparestatement模式在execute时省略了解析和准备两个阶段，执行计划还会省略优化阶段，将性能进一步提升。
* 支持使用fdatasync：redo日志文件目前采用fsync系统调用来落盘，包括文件元数据落盘和文件数据落盘。文件元数据包括最后修改时间等不是非常重要的信息，在一些redo落盘场景可以避免总是刷文件元数据到存储设备上（通过fdatasync系统调用），来减少开销。
* 支持自增列持久化：实现将自增列持久化到数据页中，避免出现自增值重复的问题。
* bufferpool初始化：加快bufferpool初始化速度，可提升近20倍，降低数据库实例启动耗时。
* FAST DDL：该功能优化二级索引创建过程的耗时。开启该功能会使用多线程并发对二级索引数据进行外部排序，同时优化flushbulkloading阶段对flushlist的加锁操作，有效降低CREATEINDEX的耗时和对并发DML的影响。
* CATS事务调度：一种新的并发事务调度算法。
* 计算下推：将单表查询的LIMIT/OFFSET或SUM操作下推到InnoDB，有效降低查询时延。

## 五、安全类改进
* 透明数据加密：沿用MySQL的透明加密体系，提供KEYRING插件的另外一种实现：KEYRING_KMS，将KEYRING和腾讯云企业级的密钥管理服务集成。
* 审计：提供数据库审计功能，记录对数据库的访问及SQL语句执行情况（包括语句开启时间、扫描行数、锁等待时间、CPU使用时间、客户端IP、用户名、SQL内容等），帮助企业进行封信啊控制，提高数据安全等级。

## 六、稳定类改进
* 秒级加列：通过只修改数据字典的方法来实现大表快速加列，避免之前加列操作必须做的数据拷贝，从而大幅缩小大表加列所需的时间，减少对系统的影响。
* 异步删除大表：用于删除数据文件很大的表，避免IO的抖动。
* 热点更新：针对于频繁更新或秒杀类业务场景，大幅度优化对于热点行书的update操作的性能。当开启热点更新自动探索时，系统会自动探测是否有单行的热点更新，如果有，则会让大量的并发update排队执行，以减少大量行锁造成的并发性能下降。
* SQL限流：通过关键字的设置，限制特定sql同一时间内可并发执行的并发度。针对某些并发量大，占用大量资源，导致系统性能下降的sql。
* statement outline：为了避免优化器无法选择合适的执行计划所带来的影响，TXSQL提供了OUTLINE功能，供用户绑定执行计划。
* 大事务限制：为了避免大事务sql执行，将binlog_write_threshold设置为了1.5G，限制了binlog日志的最大size，如果执行sql时，产生的binlog日志超过了binlog_write_threshold的设置，就会报错。当binlog日志大小超过max_binlog_size（250M）的大小时，会自动切到一个新的binlog日志，执行某些大事务，为了事务的完整性，binlog会等大事务执行完后切换，所以binlog日志大小会超过max_binlog_size（250M）